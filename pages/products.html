<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<title>ุงูุนุฑูุถ โ AYLACLINIC</title>
<link rel="stylesheet" href="../css/style.css">

<script>
const role = localStorage.getItem("role");
</script>

<!-- โ ุฅุถุงูุฉ ุจุณูุทุฉ ูุชุบููุฑ ููู ุงูุฎููุฉ ุนูุฏ ุงูุงุฎุชูุงุฑ -->
<style>
.offer.selected{
  background: #eef7ff;
  border: 2px solid #5aa9ff;
}
</style>

</head>

<body>

<header>
  <div class="brand">
    <img src="../images/logo.png">
    <strong>AYLACLINIC</strong>
  </div>\
   <nav>
<a href="../pages/index.html">ุงูุฑุฆูุณูุฉ</a>
   </nav>
</header>

<section class="hero" style="padding:50px 20px">
  <h1>ุงุฎุชูุงุฑ ุงูุนุฑูุถ</h1>
  <p>ุงุฎุชุฑ ุงูุฎุฏูุงุช ุงูุชู ุชูุงุณุจู</p>
</section>

<div class="container">

<!-- ุงูุฌูุฏูุฉ -->
<div class="section">
  <h2>๐งด ุงูุฌูุฏูุฉ</h2>
  <label class="offer">
    <span>ุชูุธูู ุงูุจุดุฑุฉ</span>
    <span>120 ุฏ.ู <input type="checkbox" data-id="skin_clean" data-name="ุชูุธูู ุงูุจุดุฑุฉ" data-price="120"></span>
  </label>
  <label class="offer">
    <span>ุนูุงุฌ ุญุจ ุงูุดุจุงุจ</span>
    <span>150 ุฏ.ู <input type="checkbox" data-id="skin_acne" data-name="ุนูุงุฌ ุญุจ ุงูุดุจุงุจ" data-price="150"></span>
  </label>
</div>

<!-- ุงูุชุฌููู -->
<div class="section">
  <h2>๐ ุงูุชุฌููู</h2>
  <label class="offer">
    <span>ุฌูุณุฉ ูุถุงุฑุฉ</span>
    <span>200 ุฏ.ู <input type="checkbox" data-id="beauty_glow" data-name="ุฌูุณุฉ ูุถุงุฑุฉ" data-price="200"></span>
  </label>
  <label class="offer">
    <span>ุจูุชููุณ</span>
    <span>300 ุฏ.ู <input type="checkbox" data-id="beauty_botox" data-name="ุจูุชููุณ" data-price="300"></span>
  </label>
</div>

<!-- ุงูุชุบุฐูุฉ -->
<div class="section">
  <h2>๐ฅ ุงูุชุบุฐูุฉ</h2>
  <label class="offer">
    <span>ุจุฑูุงูุฌ ุชุบุฐูุฉ</span>
    <span>200 ุฏ.ู <input type="checkbox" data-id="nutri_plan" data-name="ุจุฑูุงูุฌ ุชุบุฐูุฉ" data-price="200"></span>
  </label>
  <label class="offer">
    <span>ุจุฑูุงูุฌ ุชุฎุณูุณ</span>
    <span>250 ุฏ.ู <input type="checkbox" data-id="nutri_slim" data-name="ุจุฑูุงูุฌ ุชุฎุณูุณ" data-price="250"></span>
  </label>
</div>

<div class="total-box" id="total">ุงููุฌููุน: 0 ุฏ.ู</div>

<button style="width:100%" onclick="goBooking()">ุงูุงูุชูุงู ููุญุฌุฒ</button>

<!-- ููุญุฉ ุงูุฃุฏูู (ูุฎููุฉ ููุง ุชุธูุฑ ุฅูุง ุฅุฐุง role=admin) -->
<div id="adminPanel" class="section" style="display:none;margin-top:25px">
  <h2>ููุญุฉ ุงูุฃุฏูู โ ุชุนุฏูู ุงูุนุฑูุถ</h2>
  <div id="adminEditor"></div>
  <button type="button" id="saveOffersBtn" style="width:100%;margin-top:10px">ุญูุธ ุงูุชุนุฏููุงุช</button>
  <div id="adminMsg" style="text-align:center;margin-top:10px"></div>
</div>

</div>

<script>
const checks = document.querySelectorAll('input[type="checkbox"]');
const totalBox = document.getElementById("total");

/** โ ุชุบููุฑ ููู ุงูุฎููุฉ ุนูุฏ ุงูุงุฎุชูุงุฑ */
function toggleSelectedStyle(checkbox){
  const label = checkbox.closest("label.offer");
  if(!label) return;
  label.classList.toggle("selected", checkbox.checked);
}

/** ====== ุจูุงูุงุช ุงูุชุฑุงุถูุฉ (ูุทุงุจูุฉ ููุง ูู ุงูุตูุญุฉ) ====== */
const DEFAULT_OFFERS = [
  { id:"skin_clean",   name:"ุชูุธูู ุงูุจุดุฑุฉ",   price:120 },
  { id:"skin_acne",    name:"ุนูุงุฌ ุญุจ ุงูุดุจุงุจ", price:150 },
  { id:"beauty_glow",  name:"ุฌูุณุฉ ูุถุงุฑุฉ",     price:200 },
  { id:"beauty_botox", name:"ุจูุชููุณ",         price:300 },
  { id:"nutri_plan",   name:"ุจุฑูุงูุฌ ุชุบุฐูุฉ",   price:200 },
  { id:"nutri_slim",   name:"ุจุฑูุงูุฌ ุชุฎุณูุณ",   price:250 },
];

function loadOffers(){
  const saved = localStorage.getItem("offersData");
  return saved ? JSON.parse(saved) : DEFAULT_OFFERS;
}

function saveOffers(data){
  localStorage.setItem("offersData", JSON.stringify(data));
}

/** ====== ุชุทุจูู ุงูุจูุงูุงุช ุนูู ููุณ ุงูู HTML ุจุฏูู ุชุบููุฑ ุงูุดูู ====== */
function applyOffersToDOM(offers){
  offers.forEach(o=>{
    const input = document.querySelector(`input[type="checkbox"][data-id="${o.id}"]`);
    if(!input) return;

    // ุชุญุฏูุซ ุจูุงูุงุช checkbox ุงููุณุชุฎุฏูุฉ ูู ุงูุญุฌุฒ ูุงูุญุณุงุจ
    input.dataset.name = o.name;
    input.dataset.price = String(o.price);

    // ุชุญุฏูุซ ุงููุตูุต ุงูุธุงูุฑุฉ ุฏุงุฎู ููุณ ุงูู label
    const label = input.closest("label.offer");
    if(label){
      const spans = label.querySelectorAll("span");
      if(spans && spans.length >= 2){
        // span[0] ุงุณู ุงูุนุฑุถ
        spans[0].textContent = o.name;

        // span[1] ุงูุณุนุฑ + checkbox (ูุง ูุฑูุฏ ุชุบููุฑ ุงูู input)
        spans[1].innerHTML = `${o.price} ุฏ.ู `;
        spans[1].appendChild(input);
      }
    }
  });

  // ุจุนุฏ ุงูุชุญุฏูุซุ ุงุญุณุจ ุงููุฌููุน ุงูุญุงูู
  calcTotal();

  // โ ูู ูู ุนูุงุตุฑ ูุงูุช ูุญุฏุฏุฉุ ุฎูู ููููุง ูุธูุฑ ุจุนุฏ ุฃู ุชุญุฏูุซ
  checks.forEach(c => toggleSelectedStyle(c));
}

/** ====== ุญุณุงุจ ุงููุฌููุน + ุชูููู ุงูุนูุตุฑ ุงููุญุฏุฏ ====== */
checks.forEach(c=>{
  c.addEventListener("change", ()=>{
    toggleSelectedStyle(c);
    calcTotal();
  });
});

function calcTotal(){
  let total = 0;
  checks.forEach(c=>{
    if(c.checked) total += +c.dataset.price;
  });
  totalBox.textContent = `ุงููุฌููุน: ${total} ุฏ.ู`;
}

/** ====== ุงูุชูุงู ููุญุฌุฒ ====== */
function goBooking(){
  const items = [];
  let total = 0;

  checks.forEach(c=>{
    if(c.checked){
      items.push({name:c.dataset.name, price:+c.dataset.price});
      total += +c.dataset.price;
    }
  });

  if(items.length === 0){
    alert("โ ุงุฎุชุฑ ุฎุฏูุฉ ูุงุญุฏุฉ ุนูู ุงูุฃูู");
    return;
  }

  localStorage.setItem("bookingData", JSON.stringify({
    services: items,
    total: total
  }));

  window.location.href = "booking.html";
}

/** ====== ููุญุฉ ุงูุฃุฏูู ====== */
const adminPanel = document.getElementById("adminPanel");
const adminEditor = document.getElementById("adminEditor");
const saveBtn = document.getElementById("saveOffersBtn");
const adminMsg = document.getElementById("adminMsg");

let offers = loadOffers();
applyOffersToDOM(offers);

function renderAdminEditor(){
  adminEditor.innerHTML = offers.map((o, idx)=>`
    <div style="display:grid;grid-template-columns:1fr 140px;gap:10px;margin-bottom:10px;align-items:center">
      <input data-idx="${idx}" data-field="name" value="${o.name}" style="width:100%">
      <input data-idx="${idx}" data-field="price" type="number" min="0" value="${o.price}" style="width:100%">
    </div>
  `).join("");
}

if(role === "admin"){
  adminPanel.style.display = "block";
  renderAdminEditor();

  saveBtn.addEventListener("click", ()=>{
    adminEditor.querySelectorAll("input[data-idx]").forEach(inp=>{
      const idx = +inp.dataset.idx;
      const field = inp.dataset.field;

      if(field === "price"){
        const v = Number(inp.value);
        offers[idx][field] = isNaN(v) ? 0 : v;
      }else{
        offers[idx][field] = inp.value.trim();
      }
    });

    saveOffers(offers);
    applyOffersToDOM(offers);

    adminMsg.textContent = "โ ุชู ุญูุธ ุงูุชุนุฏููุงุช";
    adminMsg.style.color = "green";
  });
}
</script>

</body>
</html>
